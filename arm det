import re
import json
from docx import Document

def TableExtractor(file_path):
    table_label_pattern = re.compile(
        r"(?:Table\s+[\dA-Za-z]+:\s*)?Description\s+of\s+(?:Study\s+Arms|Interventions|Treatment)(?:\s+.+)?",
        re.IGNORECASE
    )
    
    print(f"Opening document: {file_path}")
    doc = Document(file_path)
    
    found_heading = False
    tables_data = []
    
    print(f"Document contains {len(doc.paragraphs)} paragraphs and {len(doc.tables)} tables")
    
    for i, paragraph in enumerate(doc.paragraphs):
        print(f"Checking paragraph {i}: {paragraph.text[:50]}...")
        
        if table_label_pattern.search(paragraph.text):
            print(f"Found matching heading at paragraph {i}")
            found_heading = True
            
            remaining_elements = doc.paragraphs[i+1:] + doc.tables
            
            print(f"Processing {len(remaining_elements)} elements after heading")
            
            for element in remaining_elements:
                if hasattr(element, 'rows'):
                    print("Found a table after heading")
                    table_data = []
                    for row in element.rows:
                        row_data = [cell.text.strip() for cell in row.cells]
                        table_data.append(row_data)
                    tables_data.append(table_data)
                    print(f"Extracted table with {len(table_data)} rows")
                    break
    
    if not found_heading:
        print("No matching heading found in document")
    
    print(f"Returning {len(tables_data)} tables as JSON")
    return json.dumps(tables_data, indent=2)
